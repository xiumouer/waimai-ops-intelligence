import{i as M}from"./index-BBtsgw0t.js";import{d as D,r as a,o as S,a as n,b as c,e as t,t as l,F as f,g as F,i as Y,p as x}from"./index-CIa03AWP.js";const A={class:"grid grid-2"},E={class:"card"},O={class:"card"},J={class:"metrics"},K={class:"metric-box"},L={class:"kpi kpi-primary"},$={class:"metric-box"},j={class:"kpi"},P={class:"metric-box"},V={class:"kpi kpi-danger"},q={class:"metric-box"},z={class:"kpi"},G={class:"card full"},H={class:"table"},I=["onClick"],Q=["onClick"],R={class:"card full"},T={class:"list"},U={class:"tag tag-danger"},w=D({__name:"MileagePage",setup(W){const u=a(null),d=a(0),v=a(0),p=a(0),k=a(80),_=a([]),h=a([]);function m(){Y("mileage.json").then(e=>{var s,i,o,g,y,b;d.value=Number(((s=e==null?void 0:e.summary)==null?void 0:s.totalKm)||0),v.value=Number(((i=e==null?void 0:e.summary)==null?void 0:i.riders)||0),p.value=Number(((o=e==null?void 0:e.summary)==null?void 0:o.overDaily)||0),k.value=Number(((g=e==null?void 0:e.summary)==null?void 0:g.threshold)||80),_.value=((e==null?void 0:e.ranking)||[]).map(r=>({rider:r.rider,km:Number(r.km||0)})),h.value=((e==null?void 0:e.warnings)||[]).map(r=>({rider:r.rider,date:String(r.date||""),km:Number(r.km||0)})),u.value&&M(u.value).setOption({grid:{left:40,right:20,top:20,bottom:24,containLabel:!0},xAxis:{type:"category",data:((y=e==null?void 0:e.daily)==null?void 0:y.labels)||[]},yAxis:{type:"value"},series:[{type:"bar",data:(((b=e==null?void 0:e.daily)==null?void 0:b.km)||[]).map(C=>Number(Number(C).toFixed(2))),itemStyle:{color:"#5B8CFF"}}]})}).catch(()=>{})}S(()=>{m()});function N(e){const s=prompt("请输入日期(YYYY-MM-DD)","");if(!s)return;const i=prompt("请输入里程(公里)","");if(!i)return;const o=parseFloat(i)||0;x("mileage/update",{rider:e,date:s,km:o}).then(()=>{m()}).catch(()=>{})}function B(e){x("mileage/delete-by-rider",{rider:e}).then(()=>{m()}).catch(()=>{})}return(e,s)=>(c(),n("div",A,[t("div",E,[s[0]||(s[0]=t("h3",null,"近7天总里程",-1)),t("div",{ref_key:"chartEl",ref:u,class:"chart"},null,512)]),t("div",O,[s[5]||(s[5]=t("h3",null,"里程概况",-1)),t("div",J,[t("div",K,[s[1]||(s[1]=t("div",{class:"metric-title"},"总里程(km)",-1)),t("div",L,l(d.value),1)]),t("div",$,[s[2]||(s[2]=t("div",{class:"metric-title"},"骑手数",-1)),t("div",j,l(v.value),1)]),t("div",P,[s[3]||(s[3]=t("div",{class:"metric-title"},"超里程天数",-1)),t("div",V,l(p.value),1)]),t("div",q,[s[4]||(s[4]=t("div",{class:"metric-title"},"阈值(km/天)",-1)),t("div",z,l(k.value),1)])])]),t("div",G,[s[7]||(s[7]=t("h3",null,"里程排行",-1)),t("table",H,[s[6]||(s[6]=t("thead",null,[t("tr",null,[t("th",null,"骑手"),t("th",null,"里程(km)"),t("th",null,"操作")])],-1)),t("tbody",null,[(c(!0),n(f,null,F(_.value,i=>(c(),n("tr",{key:i.rider},[t("td",null,l(i.rider),1),t("td",null,l(i.km.toFixed(2)),1),t("td",null,[t("span",{class:"action-edit",style:{"margin-left":"8px",color:"#1A5FFF",cursor:"pointer"},onClick:o=>N(i.rider)},"修改",8,I),t("span",{class:"action-del-mile",style:{"margin-left":"12px",color:"#FF6B6B",cursor:"pointer"},onClick:o=>B(i.rider)},"删除",8,Q)])]))),128))])])]),t("div",R,[s[8]||(s[8]=t("h3",null,"超里程告警",-1)),t("div",T,[(c(!0),n(f,null,F(h.value,i=>(c(),n("div",{class:"list-item",key:i.rider+"-"+i.date},[t("span",null,l(i.date)+" · "+l(i.rider),1),t("span",U,l(i.km.toFixed(2))+" km",1)]))),128))])])]))}});export{w as default};
