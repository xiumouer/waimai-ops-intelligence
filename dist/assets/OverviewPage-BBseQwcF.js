import{Z as ce,g as ye,e as Ae,a as Me,c as _e,b as we,n as be,m as Se,A as Ce,d as Le,M as Z,f as xe,h as Ie,j as Pe,k as Ee,l as Te,o as Oe,p as Ue,q as ze,r as ke,s as Re,t as De,u as Ve,v as je,w as He,x as $e,y as Fe,z as ue,B as Ze,C as Be,D as Ne,E as Ge,F as Je,G as We,H as Ye,I as qe,J as Ke,K as de,L as Xe,N as Qe,O as et,P as tt,Q as at,R as nt,S as ot,T as rt,U as st,V as it,W as lt,X as ct,Y as ut,_ as dt,$ as pt,a0 as ft,a1 as gt,a2 as vt,a3 as mt,a4 as ht,a5 as yt,a6 as At,a7 as Mt,a8 as _t,a9 as wt,aa as bt,ab as St,ac as Ct,ad as Lt,ae as xt,af as It,ag as Pt,ah as Et,ai as Tt,aj as Ot,ak as Ut,al as zt,am as B,an as pe,ao as kt,ap as Rt,aq as fe,ar as Dt,as as Vt,at as jt,au as Ht,av as $t,aw as Ft,ax as Zt,ay as Bt,az as ge,aA as Nt,aB as Gt,aC as j,aD as H,aE as N,aF as G,aG as $,aH as Jt,aI as Wt,aJ as Yt,i as F,aK as qt,aL as Kt,aM as Xt,aN as Qt,aO as ea,aP as ta,aQ as aa,aR as na,aS as oa,aT as ra,aU as sa,aV as ia,aW as ve,aX as la,aY as ca,aZ as ua,a_ as da,a$ as te,b0 as pa,b1 as fa,b2 as ga,b3 as va,b4 as ma,b5 as ha,b6 as ya,b7 as Aa,b8 as Ma,b9 as _a,ba as wa,bb as ba,bc as Sa,bd as Ca,be as La,bf as xa,bg as J,bh as Ia,bi as me,bj as Pa,bk as Ea,bl as Ta}from"./index-BBtsgw0t.js";import{d as K,r as E,o as X,k as V,a as Q,b as ee,e as g,t as T,f as Oa,l as Ua,c as za,i as ka,m as ae}from"./index-CIa03AWP.js";function Ra(t,a,o,r,f,n,e,l){var v=new ce({style:{text:t,font:a,align:o,verticalAlign:r,padding:f,rich:n,overflow:e?"truncate":null,lineHeight:l}});return v.getBoundingRect()}function Da(t){return _e(null,t)}var Va={isDimensionStacked:Me,enableDataStack:Ae,getStackedDimension:ye};function ja(t,a){var o=a;a instanceof Z||(o=new Z(a));var r=we(o);return r.setExtent(t[0],t[1]),be(r,o),r}function Ha(t){Se(t,Ce)}function $a(t,a){return a=a||{},Le(t,null,null,a.state!=="normal")}const Fa=Object.freeze(Object.defineProperty({__proto__:null,createDimensions:xe,createList:Da,createScale:ja,createSymbol:Ie,createTextStyle:$a,dataStack:Va,enableHoverEmphasis:Pe,getECData:Ee,getLayoutRect:Te,mixinAxisModelCommonMethods:Ha},Symbol.toStringTag,{value:"Module"})),Za=Object.freeze(Object.defineProperty({__proto__:null,MAX_SAFE_INTEGER:Oe,asc:Ue,getPercentWithPrecision:ze,getPixelPrecision:ke,getPrecision:Re,getPrecisionSafe:De,isNumeric:Ve,isRadianAroundZero:je,linearMap:He,nice:$e,numericToNumber:Fe,parseDate:ue,quantile:Ze,quantity:Be,quantityExponent:Ne,reformIntervals:Ge,remRadian:Je,round:We},Symbol.toStringTag,{value:"Module"})),Ba=Object.freeze(Object.defineProperty({__proto__:null,format:Ye,parse:ue},Symbol.toStringTag,{value:"Module"})),Na=Object.freeze(Object.defineProperty({__proto__:null,Arc:qe,BezierCurve:Ke,BoundingRect:de,Circle:Xe,CompoundPath:Qe,Ellipse:et,Group:tt,Image:at,IncrementalDisplayable:nt,Line:ot,LinearGradient:rt,Polygon:st,Polyline:it,RadialGradient:lt,Rect:ct,Ring:ut,Sector:dt,Text:ce,clipPointsByRect:pt,clipRectByRect:ft,createIcon:gt,extendPath:vt,extendShape:mt,getShapeClass:ht,getTransform:yt,initProps:At,makeImage:Mt,makePath:_t,mergePath:wt,registerShape:bt,resizePath:St,updateProps:Ct},Symbol.toStringTag,{value:"Module"})),Ga=Object.freeze(Object.defineProperty({__proto__:null,addCommas:Lt,capitalFirst:xt,encodeHTML:It,formatTime:Pt,formatTpl:Et,getTextRect:Ra,getTooltipMarker:Tt,normalizeCssArray:Ot,toCamelCase:Ut,truncateText:zt},Symbol.toStringTag,{value:"Module"})),Ja=Object.freeze(Object.defineProperty({__proto__:null,bind:B,clone:pe,curry:kt,defaults:Rt,each:fe,extend:Dt,filter:Vt,indexOf:jt,inherits:Ht,isArray:$t,isFunction:Ft,isObject:Zt,isString:Bt,map:ge,merge:Nt,reduce:Gt},Symbol.toStringTag,{value:"Module"}));function Wa(t){var a=j.extend(t);return j.registerClass(a),a}function Ya(t){var a=H.extend(t);return H.registerClass(a),a}function qa(t){var a=N.extend(t);return N.registerClass(a),a}function Ka(t){var a=G.extend(t);return G.registerClass(a),a}var Xa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var he={exports:{}};(function(t,a){(function(o,r){t.exports=r()})(Xa,function(){function o(i){var h=[];return i.AMapUI&&h.push(r(i.AMapUI)),i.Loca&&h.push(f(i.Loca)),Promise.all(h)}function r(i){return new Promise(function(h,p){var m=[];if(i.plugins)for(var c=0;c<i.plugins.length;c+=1)e.AMapUI.plugins.indexOf(i.plugins[c])==-1&&m.push(i.plugins[c]);if(l.AMapUI===n.failed)p("前次请求 AMapUI 失败");else if(l.AMapUI===n.notload){l.AMapUI=n.loading,e.AMapUI.version=i.version||e.AMapUI.version,c=e.AMapUI.version;var s=document.body||document.head,u=document.createElement("script");u.type="text/javascript",u.src="https://webapi.amap.com/ui/"+c+"/main.js",u.onerror=function(d){l.AMapUI=n.failed,p("请求 AMapUI 失败")},u.onload=function(){if(l.AMapUI=n.loaded,m.length)window.AMapUI.loadUI(m,function(){for(var d=0,A=m.length;d<A;d++){var _=m[d].split("/").slice(-1)[0];window.AMapUI[_]=arguments[d]}for(h();v.AMapUI.length;)v.AMapUI.splice(0,1)[0]()});else for(h();v.AMapUI.length;)v.AMapUI.splice(0,1)[0]()},s.appendChild(u)}else l.AMapUI===n.loaded?i.version&&i.version!==e.AMapUI.version?p("不允许多个版本 AMapUI 混用"):m.length?window.AMapUI.loadUI(m,function(){for(var d=0,A=m.length;d<A;d++){var _=m[d].split("/").slice(-1)[0];window.AMapUI[_]=arguments[d]}h()}):h():i.version&&i.version!==e.AMapUI.version?p("不允许多个版本 AMapUI 混用"):v.AMapUI.push(function(d){d?p(d):m.length?window.AMapUI.loadUI(m,function(){for(var A=0,_=m.length;A<_;A++){var b=m[A].split("/").slice(-1)[0];window.AMapUI[b]=arguments[A]}h()}):h()})})}function f(i){return new Promise(function(h,p){if(l.Loca===n.failed)p("前次请求 Loca 失败");else if(l.Loca===n.notload){l.Loca=n.loading,e.Loca.version=i.version||e.Loca.version;var m=e.Loca.version,c=e.AMap.version.startsWith("2"),s=m.startsWith("2");if(c&&!s||!c&&s)p("JSAPI 与 Loca 版本不对应！！");else{c=e.key,s=document.body||document.head;var u=document.createElement("script");u.type="text/javascript",u.src="https://webapi.amap.com/loca?v="+m+"&key="+c,u.onerror=function(d){l.Loca=n.failed,p("请求 AMapUI 失败")},u.onload=function(){for(l.Loca=n.loaded,h();v.Loca.length;)v.Loca.splice(0,1)[0]()},s.appendChild(u)}}else l.Loca===n.loaded?i.version&&i.version!==e.Loca.version?p("不允许多个版本 Loca 混用"):h():i.version&&i.version!==e.Loca.version?p("不允许多个版本 Loca 混用"):v.Loca.push(function(d){d?p(d):p()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var n;(function(i){i.notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed"})(n||(n={}));var e={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},l={AMap:n.notload,AMapUI:n.notload,Loca:n.notload},v={AMapUI:[],Loca:[]},y=[],M=function(i){typeof i=="function"&&(l.AMap===n.loaded?i(window.AMap):y.push(i))};return{load:function(i){return new Promise(function(h,p){if(l.AMap==n.failed)p("");else if(l.AMap==n.notload){var m=i.key,c=i.version,s=i.plugins;m?(window.AMap&&location.host!=="lbs.amap.com"&&p("禁止多种API加载方式混用"),e.key=m,e.AMap.version=c||e.AMap.version,e.AMap.plugins=s||e.AMap.plugins,l.AMap=n.loading,c=document.body||document.head,window.___onAPILoaded=function(d){if(delete window.___onAPILoaded,d)l.AMap=n.failed,p(d);else for(l.AMap=n.loaded,o(i).then(function(){h(window.AMap)}).catch(p);y.length;)y.splice(0,1)[0]()},s=document.createElement("script"),s.type="text/javascript",s.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+e.AMap.version+"&key="+m+"&plugin="+e.AMap.plugins.join(","),s.onerror=function(d){l.AMap=n.failed,p(d)},c.appendChild(s)):p("请填写key")}else if(l.AMap==n.loaded)if(i.key&&i.key!==e.key)p("多个不一致的 key");else if(i.version&&i.version!==e.AMap.version)p("不允许多个版本 JSAPI 混用");else{if(m=[],i.plugins)for(c=0;c<i.plugins.length;c+=1)e.AMap.plugins.indexOf(i.plugins[c])==-1&&m.push(i.plugins[c]);m.length?window.AMap.plugin(m,function(){o(i).then(function(){h(window.AMap)}).catch(p)}):o(i).then(function(){h(window.AMap)}).catch(p)}else if(i.key&&i.key!==e.key)p("多个不一致的 key");else if(i.version&&i.version!==e.AMap.version)p("不允许多个版本 JSAPI 混用");else{var u=[];if(i.plugins)for(c=0;c<i.plugins.length;c+=1)e.AMap.plugins.indexOf(i.plugins[c])==-1&&u.push(i.plugins[c]);M(function(){u.length?window.AMap.plugin(u,function(){o(i).then(function(){h(window.AMap)}).catch(p)}):o(i).then(function(){h(window.AMap)}).catch(p)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,e={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},l={AMap:n.notload,AMapUI:n.notload,Loca:n.notload},v={AMap:[],AMapUI:[],Loca:[]}}}})})(he);var en=he.exports;const W=Qa(en),tn={class:"card weather-card full"},an={class:"weather-header"},nn={style:{display:"flex",gap:"8px","align-items":"center"}},on={class:"weather-grid"},rn={class:"weather-metrics"},sn={class:"metric"},ln={class:"metric"},cn={class:"metric"},un={class:"metric"},dn={class:"subtext"},pn={class:"weather-tips"},fn={class:"tip-box"},gn=K({__name:"WeatherBox",props:{center:{}},setup(t){const a=t,o=E(null),r=E(""),f=E("--"),n=E("--"),e=E("--"),l=E("--"),v=E("");let y=null,M=0;function i(s){const u=parseFloat((s==null?void 0:s.temperature)||"0"),d=parseFloat(String((s==null?void 0:s.windpower)||"0").replace("级",""))||0,A=String((s==null?void 0:s.weather)||""),_=parseFloat((s==null?void 0:s.humidity)||"0");return/雨|雷/.test(A)?"降雨注意穿戴雨具，减速慢行":/雪/.test(A)?"路面湿滑，注意防滑与保暖":/雾|霾/.test(A)?"能见度低，注意减速与灯光":u>=33?"高温作业注意补水与轮休":u<=12?"气温偏凉，建议长袖外套 注意保暖":d>=6?"风力较大，注意防风与避险":_<=30?"空气干燥，适当补水":"注意安全，合理安排休息与补水"}function h(){const s=window.APP_CONFIG||{};return s.AMAP_SECURITY_JS&&(window._AMapSecurityConfig={securityJsCode:s.AMAP_SECURITY_JS}),s.AMAP_KEY||""}async function p(s){const u=new s.Geocoder,d=new s.Weather,A=a.center,_=new s.LngLat(A[0],A[1]);u.getAddress(_,function(b,w){const O=b==="complete"&&w&&w.regeocode&&w.regeocode.addressComponent||{},x=O.adcode||"110000",I=O.city||O.province||"";r.value=String(I||""),d.getLive(x,function(U,P){if(U){v.value="天气服务暂时不可用";return}f.value=String(P.temperature||"--"),n.value=String(P.weather||""),e.value=String(P.humidity||"--"),l.value=String(P.windpower||"--"),v.value=i(P)})})}async function m(){var A,_;const s=Date.now();if(s-M<8e3)return;M=s,y||(y=W.load({key:h(),version:"2.0",plugins:["AMap.Geocoder","AMap.Weather","AMap.CitySearch"]}));const u=await y,d=(_=(A=o.value)==null?void 0:A.value)==null?void 0:_.trim();if(d){const b=new u.Geocoder,w=new u.Weather;b.getLocation(d,function(O,x){if(O==="complete"&&x&&x.geocodes&&x.geocodes[0]){const I=x.geocodes[0],U=I.adcode||"110000",P=I.city||I.formattedAddress||d;r.value=String(P||""),w.getLive(U,function(D,L){if(D){v.value="天气服务暂时不可用";return}f.value=String(L.temperature||"--"),n.value=String(L.weather||""),e.value=String(L.humidity||"--"),l.value=String(L.windpower||"--"),v.value=i(L)})}})}else await p(await y)}function c(){m()}return X(()=>{m()}),V(()=>a.center,async()=>{try{const s=await(y||(y=W.load({key:h(),version:"2.0",plugins:["AMap.Geocoder","AMap.Weather"]})));await p(s)}catch{}}),(s,u)=>(ee(),Q("div",tn,[g("div",an,[u[0]||(u[0]=g("h3",null,"天气提醒",-1)),g("div",nn,[g("input",{ref_key:"cityInput",ref:o,type:"text",placeholder:"输入城市，如 北京",style:{height:"28px","border-radius":"4px",border:"1px solid #E9ECEF",padding:"0 8px","font-size":"12px"}},null,512),g("button",{class:"btn btn-primary btn-sm",onClick:c},"切换城市"),g("button",{class:"btn btn-primary btn-sm",onClick:m},"更新天气")])]),g("div",on,[g("div",rn,[g("div",sn,[u[1]||(u[1]=g("span",{class:"label"},"温度",-1)),g("span",null,T(f.value)+"°C",1)]),g("div",ln,[u[2]||(u[2]=g("span",{class:"label"},"湿度",-1)),g("span",null,T(e.value)+"%",1)]),g("div",cn,[u[3]||(u[3]=g("span",{class:"label"},"天气",-1)),g("span",null,T(n.value),1)]),g("div",un,[u[4]||(u[4]=g("span",{class:"label"},"风力",-1)),g("span",null,T(l.value),1)]),g("div",dn,[u[5]||(u[5]=Oa("位置来源：高德地图 · ",-1)),g("span",null,T(r.value),1)])]),g("div",pn,[u[6]||(u[6]=g("h4",null,"今日出行建议",-1)),g("div",fn,T(v.value),1)])])]))}});$([Jt,Wt]);const vn={init:function(){return F.apply(null,arguments)}};$(Yt);const mn=Object.freeze(Object.defineProperty({__proto__:null,Axis:qt,ChartView:G,ComponentModel:j,ComponentView:H,List:Kt,Model:Z,PRIORITY:Xt,SeriesModel:N,color:Qt,connect:ea,dataTool:ta,default:vn,dependencies:aa,disConnect:na,disconnect:oa,dispose:ra,env:sa,extendChartView:Ka,extendComponentModel:Wa,extendComponentView:Ya,extendSeriesModel:qa,format:Ga,getCoordinateSystemDimensions:ia,getInstanceByDom:ve,getInstanceById:la,getMap:ca,graphic:Na,helper:Fa,init:F,innerDrawElementOnCanvas:ua,matrix:da,number:Za,parseGeoJSON:te,parseGeoJson:te,registerAction:pa,registerCoordinateSystem:fa,registerLayout:ga,registerLoading:va,registerLocale:ma,registerMap:ha,registerPostInit:ya,registerPostUpdate:Aa,registerPreprocessor:Ma,registerProcessor:_a,registerTheme:wa,registerTransform:ba,registerUpdateLifecycle:Sa,registerVisual:Ca,setCanvasCreator:La,setPlatformAPI:xa,throttle:J,time:Ba,use:$,util:Ja,vector:Ia,version:me,zrUtil:Pa,zrender:Ea},Symbol.toStringTag,{value:"Module"}));/*!
 * echarts-extension-amap 
 * @version 1.12.0
 * @author plainheart
 * 
 * MIT License
 * 
 * Copyright (c) 2019-2024 Zhongxiang Wang
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */var Y=me.split("."),k=Y[0]>4,C="amap",hn=function(){return!AMap.v&&AMap.version&&AMap.version.split(".")[0]>=2};function yn(t,a){return t&&a&&t[0]===a[0]&&t[1]===a[1]}var q={};function ne(t,a,o){var r="[ECharts][Extension][AMap]".concat(t?" "+t+":":""," ").concat(a);o&&q[r]||console.warn(r),o&&(q[r]=!0)}function An(){q={}}function Mn(t,a){return a=a||[0,0],ge([0,1],function(o){var r=a[o],f=t[o]/2,n=[],e=[];return n[o]=r-f,e[o]=r+f,n[1-o]=e[1-o]=a[1-o],Math.abs(this.dataToPoint(n)[o]-this.dataToPoint(e)[o])},this)}var _n=["echartsLayerZIndex","echartsLayerInteractive","renderOnMoving","largeMode","returnMapCameraState","layers"];function R(t,a){this._amap=t,this._api=a,this._mapOffset=[0,0]}var S=R.prototype;S.setZoom=function(t){this._zoom=t};S.setCenter=function(t){var a=new AMap.LngLat(t[0],t[1]);this._center=this._amap.lngLatToContainer(a)};S.setMapOffset=function(t){this._mapOffset=t};S.setAMap=function(t){this._amap=t};S.getAMap=function(){return this._amap};S.dataToPoint=function(t){var a=new AMap.LngLat(t[0],t[1]),o=this._amap.lngLatToContainer(a),r=this._mapOffset;return[o.x-r[0],o.y-r[1]]};S.pointToData=function(t){var a=this._mapOffset,o=this._amap.containerToLngLat(new AMap.Pixel(t[0]+a[0],t[1]+a[1]));return[o.lng,o.lat]};S.getViewRect=function(){var t=this._api;return new de(0,0,t.getWidth(),t.getHeight())};S.getRoamTransform=function(){return Ta()};S.prepareCustoms=function(){var t=this.getViewRect();return{coordSys:{type:C,x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:B(this.dataToPoint,this),size:B(Mn,this)}}};S.convertToPixel=function(t,a,o){return this.dataToPoint(o)};S.convertFromPixel=function(t,a,o){return this.pointToData(o)};R.create=function(t,a){var o;return t.eachComponent(C,function(r){if(typeof AMap>"u")throw new Error("AMap api is not loaded");if(o)throw new Error("Only one amap component is allowed");var f=r.getAMap(),n=r.get("echartsLayerInteractive");if(!f){var e=a.getDom(),l=a.getZr().painter,v=l.getViewportRoot();v.className=C+"-ec-layer",v.style.visibility="hidden";var y="ec-extension-"+C,M=e.querySelector("."+y);M&&(v.style.left="0px",v.style.top="0px",e.removeChild(M)),M=document.createElement("div"),M.className=y,M.style.cssText="position:absolute;top:0;left:0;bottom:0;right:0;",e.appendChild(M);var i=pe(r.get());"echartsLayerZIndex"in i&&ne("DEPRECATED","the option `echartsLayerZIndex` has been removed since v1.9.0, use `echartsLayerInteractive` instead."),fe(_n,function(w){delete i[w]}),f=new AMap.Map(M,i),f.on("complete",function(){M.querySelector(".amap-maps").appendChild(v),v.style.visibility=""}),r.setAMap(f),r.setEChartsLayer(v),l.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}var h=r.__echartsLayerInteractive;h!==n&&(r.setEChartsLayerInteractive(n),r.__echartsLayerInteractive=n);var p=r.get("center"),m=r.get("zoom");if(p&&m){var c=f.getCenter(),s=f.getZoom(),u=r.centerOrZoomChanged([c.lng,c.lat],s);u&&f.setZoomAndCenter(m,new AMap.LngLat(p[0],p[1]))}var d=r.__mapStyle,A=r.get("mapStyle");if(d!==A&&f.setMapStyle(r.__mapStyle=A),f.setLang){var _=r.__mapLang,b=r.get("lang");_!==b&&f.setLang(r.__mapLang=b)}else ne("CAVEAT","The current map doesn't support `setLang` API!",!0);o=new R(f,a),o.setMapOffset(r.__mapOffset||[0,0]),o.setZoom(m),o.setCenter(p),r.coordinateSystem=o}),t.eachSeries(function(r){r.get("coordinateSystem")===C&&(r.coordinateSystem=o)}),o&&[o]};S.dimensions=R.dimensions=["lng","lat"];S.type=C;var oe={type:C,setAMap:function(a){this.__amap=a},getAMap:function(){return this.__amap},setEChartsLayer:function(a){this.__echartsLayer=a},getEChartsLayer:function(){return this.__echartsLayer},setEChartsLayerVisibility:function(a){this.__echartsLayer.style.display=a?"block":"none"},setEChartsLayerInteractive:function(a){this.option.echartsLayerInteractive=!!a,this.__echartsLayer.style.pointerEvents=a?"auto":"none"},setCenterAndZoom:function(a,o){this.option.center=a,this.option.zoom=o},centerOrZoomChanged:function(a,o){var r=this.option;return!(yn(a,r.center)&&o===r.zoom)},defaultOption:{center:[116.397428,39.90923],zoom:5,isHotspot:!1,resizeEnable:!0,echartsLayerInteractive:!0,renderOnMoving:!0,largeMode:!1,returnMapCameraState:!1}},re=k?j.extend(oe):oe,z,se={type:C,init:function(){this._isFirstRender=!0,z=hn()},render:function(a,o,r){var f=this,n=!0,e=a.getAMap(),l=r.getZr().painter.getViewportRoot(),v=e.getContainer(),y=a.coordinateSystem,M=a.get("renderOnMoving"),i=a.get("resizeEnable"),h=a.get("largeMode"),p=a.get("returnMapCameraState"),m=e.getViewMode_(),c=m==="3D",s=function(w){if(!n){var O=v.style,x=[-parseInt(O.left,10)||0,-parseInt(O.top,10)||0],I=l.style,U=x[0]+"px",P=x[1]+"px";I.left!==U&&(I.left=U),I.top!==P&&(I.top=P),y.setMapOffset(a.__mapOffset=x);var D={type:"amapRoam",animation:{duration:0}};if(p){w=w||{};var L=w.center;L||(L=e.getCenter(),L=[L.lng,L.lat]),D.camera={viewMode:m,center:L,zoom:w.zoom||e.getZoom(),rotation:w.rotation==null?e.getRotation():w.rotation,pitch:w.pitch==null?e.getPitch():w.pitch,scale:e.getScale(),bounds:e.getBounds()}}r.dispatchAction(D)}};if(e.off("mapmove",this._moveHandler),e.off("moveend",this._moveHandler),e.off("viewchange",this._moveHandler),e.off("camerachange",this._moveHandler),e.off("zoom",this._moveHandler),this._resizeHandler&&e.off("resize",this._resizeHandler),this._moveStartHandler&&e.off("movestart",this._moveStartHandler),this._moveEndHandler&&(e.off("moveend",this._moveEndHandler),e.off("zoomend",this._moveEndHandler)),e.on(M?z?"viewchange":c?"camerachange":"mapmove":"moveend",!z&&h?s=J(s,20,!0):s),this._moveHandler=s,M&&!(z&&c)&&e.on("zoom",s),!M){e.on("movestart",this._moveStartHandler=function(){setTimeout(function(){a.setEChartsLayerVisibility(!1)},0)});var u=this._moveEndHandler=function(b){(!b||b.type!=="moveend")&&s(b),setTimeout(function(){a.setEChartsLayerVisibility(!0)},z||!h?0:20)};if(e.on("moveend",u),e.on("zoomend",u),this._isFirstRender&&c){var d=e.setPitch,A=e.setRotation;e.setPitch=function(){d.apply(this,arguments),u()},e.setRotation=function(){A.apply(this,arguments),u()}}}if(i){var _=function(){clearTimeout(f._resizeTimeout),f._resizeTimeout=setTimeout(function(){return ve(r.getDom()).resize()},0)};!z&&h&&(_=J(_,20,!0)),e.on("resize",this._resizeHandler=_)}this._isFirstRender=n=!1},dispose:function(){clearTimeout(this._resizeTimeout),An();var a=this.__model;a&&(a.getAMap().destroy(),a.setAMap(null),a.setEChartsLayer(null),a.coordinateSystem&&(a.coordinateSystem.setAMap(null),a.coordinateSystem=null)),delete this._moveHandler,delete this._moveStartHandler,delete this._moveEndHandler,delete this._resizeHandler,delete this._resizeTimeout}},ie=k?H.extend(se):se;function le(t){(!k||Y[0]==5&&Y[1]<4)&&t.registerLayout(function(a){a.eachSeriesByType("pie",function(o){var r=o.coordinateSystem,f=o.getData(),n=f.mapDimension("value");if(r&&r.type===C){var e=o.get("center"),l=r.dataToPoint(e),v=l[0],y=l[1];f.each(n,function(M,i){var h=f.getItemLayout(i);h.cx=v,h.cy=y})}})}),k?t.registerComponentModel(re):t.extendComponentModel(re),k?t.registerComponentView(ie):t.extendComponentView(ie),t.registerCoordinateSystem(C,R),t.registerAction({type:C+"Roam",event:C+"Roam",update:"updateLayout"},function(a,o){o.eachComponent(C,function(r){var f=r.getAMap(),n=f.getCenter();r.setCenterAndZoom([n.lng,n.lat],f.getZoom())})})}k?$(le):le(mn);const wn=K({__name:"MapView",props:{center:{},riders:{},alerts:{}},emits:["center-changed"],setup(t,{emit:a}){const o=t,r=a,f=E(null);let n=null,e=null,l={},v=null,y=null,M=null;function i(){const c=window.APP_CONFIG||{};return c.AMAP_SECURITY_JS&&(window._AMapSecurityConfig={securityJsCode:c.AMAP_SECURITY_JS}),c.AMAP_KEY||""}async function h(){const c=i();if(M||(M=W.load({key:c,version:"2.0",plugins:["AMap.Scale","AMap.Geocoder","AMap.Weather","AMap.CitySearch"]})),await M,!f.value)return;e=F(f.value),e.setOption({amap:{center:o.center,zoom:12,resizeEnable:!0,renderOnMoving:!0},tooltip:{trigger:"item",formatter:function(d){return"告警："+(d.name||"未知")}},series:[{id:"alerts",name:"异常告警",type:"effectScatter",coordinateSystem:"amap",rippleEffect:{scale:3},symbolSize:10,itemStyle:{color:"#FF6B6B"},data:[]}]});const u=e.getModel().getComponent("amap").getAMap();n=u,n.on("moveend",()=>{const d=n.getCenter();r("center-changed",[d.getLng(),d.getLat()])}),u.addControl(new window.AMap.Scale);try{v=new ResizeObserver(()=>{try{e==null||e.resize(),n==null||n.resize()}catch{}}),f.value&&v.observe(f.value),document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible")try{e==null||e.resize();const d=n.getCenter();n.setCenter(d)}catch{}}),y=setInterval(()=>{if(document.visibilityState==="visible")try{const d=n.getCenter();n.setCenter(d)}catch{}},15e3)}catch{}}function p(){if(!n)return;const c={};o.riders.forEach(s=>{c[s.name]=s}),Object.keys(l).forEach(s=>{c[s]||(l[s].setMap(null),delete l[s])}),o.riders.forEach(s=>{const u=s.pos;l[s.name]?l[s.name].setPosition(u):l[s.name]=new window.AMap.Marker({map:n,position:u})})}function m(){if(e){const c=o.alerts.map(s=>({value:[s.pos[0],s.pos[1]],name:s.key}));e.setOption({series:[{id:"alerts",data:c}]},{notMerge:!1})}}return V(()=>o.center,c=>{n&&n.setCenter(c),e&&e.setOption({amap:{center:c}})}),V(()=>o.riders,()=>p(),{deep:!0}),V(()=>o.alerts,()=>m(),{deep:!0}),X(()=>{h().then(()=>{p(),m()})}),Ua(()=>{e==null||e.dispose(),e=null,n==null||n.destroy(),n=null;try{v==null||v.disconnect(),v=null}catch{}if(y){try{clearInterval(y)}catch{}y=null}}),(c,s)=>(ee(),Q("div",{ref_key:"mapEl",ref:f,class:"map",style:{height:"360px"}},null,512))}}),bn={class:"page visible"},Sn={class:"grid grid-3"},Cn={class:"card"},Ln={class:"kpi kpi-primary"},xn={class:"card"},In={class:"kpi kpi-success"},Pn={class:"subtext"},En={class:"card"},Tn={class:"kpi kpi-danger"},On={class:"card full"},kn=K({__name:"OverviewPage",props:{center:{},riders:{},alerts:{},overview:{}},emits:["center-changed"],setup(t){const a=t,o=E(null),r=E({orders:0,onlineRiders:0,alerts:0,onlineRidersChange:0}),f=za(()=>{const n=Math.round((r.value.onlineRidersChange||0)*1e3)/10;return(n>0?"+":"")+n+"%"});return X(()=>{const n=a.overview,e=l=>{try{if(l!=null&&l.kpi&&(r.value=l.kpi),o.value&&(l!=null&&l.chart)){const v=F(o.value),y={type:"linear",x:0,y:0,x2:1,y2:0,colorStops:[{offset:0,color:"#1A5FFF"},{offset:1,color:"#7A5CFA"}]};v.setOption({animationDuration:700,animationDurationUpdate:300,animationEasing:"cubicOut",grid:{left:40,right:24,top:20,bottom:24,containLabel:!0},tooltip:{trigger:"axis"},xAxis:{type:"category",boundaryGap:!1,data:l.chart.labels||[]},yAxis:{type:"value",axisLabel:{margin:8}},series:[{name:"订单量",type:"line",smooth:!0,data:l.chart.orders||[],lineStyle:{width:3,color:y},areaStyle:{color:y}}]})}}catch{}};n?e(n):ka("overview.json").then(e).catch(()=>{})}),(n,e)=>(ee(),Q("section",bn,[g("div",Sn,[g("div",Cn,[e[1]||(e[1]=g("h3",null,"今日订单",-1)),g("div",Ln,T(r.value.orders),1),g("div",{ref_key:"chartEl",ref:o,class:"chart"},null,512)]),g("div",xn,[e[2]||(e[2]=g("h3",null,"在线骑手",-1)),g("div",In,T(r.value.onlineRiders),1),g("div",Pn,"较昨日 "+T(f.value),1)]),g("div",En,[e[3]||(e[3]=g("h3",null,"异常告警",-1)),g("div",Tn,T(r.value.alerts),1),e[4]||(e[4]=g("div",{class:"subtext"},"配送延迟、偏航",-1))])]),ae(gn,{center:t.center},null,8,["center"]),g("div",On,[e[5]||(e[5]=g("h3",null,"地图",-1)),ae(wn,{center:t.center,riders:t.riders,alerts:t.alerts,onCenterChanged:e[0]||(e[0]=l=>n.$emit("center-changed",l))},null,8,["center","riders","alerts"])])]))}});export{kn as default};
